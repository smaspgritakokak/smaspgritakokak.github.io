<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulir Pendaftaran - SPMB</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-10 px-4">

  <div class="max-w-3xl mx-auto bg-white shadow-xl rounded-xl p-6">
    <h2 class="text-2xl font-bold text-blue-700 mb-6 text-center">Formulir Pendaftaran Siswa Baru</h2>

    <form id="formulirForm" class="space-y-4">

      <!-- NISN -->
      <div>
        <label class="block text-sm font-medium text-gray-700">NISN</label>
        <input type="text" name="nisn" required class="w-full mt-1 border rounded px-3 py-2" />
      </div>

      <!-- NIK -->
      <div>
        <label class="block text-sm font-medium text-gray-700">NIK</label>
        <input type="text" name="nik" required class="w-full mt-1 border rounded px-3 py-2" />
      </div>

      <!-- Nama Lengkap -->
      <div>
        <label class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
        <input type="text" name="nama" required class="w-full mt-1 border rounded px-3 py-2" />
      </div>

      <!-- Tempat dan Tanggal Lahir -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Tempat Lahir</label>
          <input type="text" name="tempat_lahir" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Tanggal Lahir</label>
          <input type="date" name="tanggal_lahir" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
      </div>

      <!-- Alamat -->
      <div>
        <label class="block text-sm font-medium text-gray-700">Alamat Lengkap</label>
        <textarea name="alamat" rows="2" required class="w-full mt-1 border rounded px-3 py-2"></textarea>
      </div>

      <!-- No HP -->
      <div>
        <label class="block text-sm font-medium text-gray-700">No. HP Pribadi</label>
        <input type="tel" name="hp_siswa" required class="w-full mt-1 border rounded px-3 py-2" />
      </div>

      <!-- Orang Tua -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Nama Ayah</label>
          <input type="text" name="ayah" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Nama Ibu</label>
          <input type="text" name="ibu" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
      </div>

      <!-- No HP Ortu -->
      <div>
        <label class="block text-sm font-medium text-gray-700">No. HP Orang Tua</label>
        <input type="tel" name="hp_ortu" required class="w-full mt-1 border rounded px-3 py-2" />
      </div>

      <!-- Asal Sekolah & Tahun Lulus -->
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700">Asal Sekolah</label>
          <input type="text" name="asal_sekolah" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700">Tahun Lulus</label>
          <input type="number" name="tahun_lulus" required class="w-full mt-1 border rounded px-3 py-2" />
        </div>
      </div>

      <!-- Tombol -->
      <div class="pt-4">
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
          Kirim Formulir
        </button>
      </div>

    </form>

    <p id="statusMsg" class="text-center text-green-600 mt-4 hidden">Formulir berhasil dikirim...</p>
  </div>

  <script>
    const BASE_URL = "https://script.google.com/macros/s/AKfycbxHz_-u1sWm2fQ-XFEfTRxQHHeag82vtp-6gH-_iE40TH1CIS7hfnpuQUnZ1otvRLSZ/exec";

    document.getElementById("formulirForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const json = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(BASE_URL, {
          method: "POST",
          body: JSON.stringify(json),
          headers: { "Content-Type": "application/json" }
        });
        const result = await res.json();

        if (result.success && result.id_registrasi) {
          document.getElementById("statusMsg").classList.remove("hidden");
          window.location.href = `cetak.html?id=${result.id_registrasi}`;
        } else {
          alert("Gagal menyimpan data. Silakan ulangi.");
        }

      } catch (err) {
        console.error(err);
        alert("Terjadi kesalahan koneksi.");
      }
    });
  </script>

</body>
</html>
